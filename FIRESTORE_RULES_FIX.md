# ุฅุตูุงุญ Firebase Security Rules ๐

## โ๏ธ ุงููุดููุฉ:

```
[cloud_firestore/permission-denied] Missing or insufficient permissions.
```

**ุงูุณุจุจ:** ุฏุงูุฉ `isAdmin()` ุชุณุชุฎุฏู `request.auth.token.admin == true` ุจุฏูุงู ูู ุงูุชุญูู ูู Firestore.

---

## โ ุงูุญู:

### ุงููุดููุฉ ูู ุงูููุฏ ุงูุญุงูู:

```javascript
function isAdmin() {
  return isSignedIn() && request.auth.token.admin == true;
}
```

**โ ูุฐุง ุฎุงุทุฆ** ูุฃู `role` ูุญููุธ ูู ูุซููุฉ `users/{userId}` ูู Firestoreุ ูููุณ ูู token.

### ุงูููุฏ ุงูุตุญูุญ:

```javascript
function isAdmin() {
  return isSignedIn() && 
         get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
}
```

**โ ูุฐุง ุตุญูุญ** ูุฃูู ูุชุญูู ูู `role` ูู Firestore.

---

## ๐ ุงูููุงุนุฏ ุงููุญุฏุซุฉ:

ุชู ุชุญุฏูุซ ุฌููุน ุงูููุงุนุฏ ูุงุณุชุฎุฏุงู `isAdmin()` ุงูุตุญูุญุฉ:

### 1. Products:
- โ ุงููุฑุงุกุฉ: ุงูุฌููุน (`allow read: if true`)
- โ ุงููุชุงุจุฉ: Admin ููุท (`allow write: if isAdmin()`)

### 2. Orders:
- โ ุงููุฑุงุกุฉ: ุงููุณุชุฎุฏู ููุฑุฃ ุทูุจุงุชูุ ุฃู Admin ููุฑุฃ ุงููู
- โ ุงูุฅูุดุงุก: ุงููุณุชุฎุฏู ููููู ุฅูุดุงุก ุทูุจ ูู ููุท
- โ ุงูุชุญุฏูุซ: ุงููุณุชุฎุฏู ูุญุฏุซ ุทูุจูุ ุฃู Admin ูุญุฏุซ ุฃู ุทูุจ
- โ ุงูุญุฐู: Admin ููุท

### 3. Users:
- โ ุงููุฑุงุกุฉ: ุงููุณุชุฎุฏู ููุฑุฃ ุจูุงูุงุชูุ ุฃู Admin ููุฑุฃ ุงููู
- โ ุงููุชุงุจุฉ: ุงููุณุชุฎุฏู ููุชุจ ุจูุงูุงุชู (ูุน ุญูุงูุฉ role)
- โ ุญูุงูุฉ role: ูุง ูููู ุชุบููุฑ role ุฅูุง ุฅุฐุง ูุงู Admin

---

## ๐ง ุงูุฎุทูุงุช:

### 1. ุงุณุชุจุฏุงู ุงูููุงุนุฏ ูู Firebase Console:

1. ุงูุชุญ [Firebase Console](https://console.firebase.google.com/)
2. ุงุฎุชุฑ ูุดุฑูุนู `seafood-marketplace-c98ae`
3. ุงูุชูู ุฅูู **Firestore Database** > **Rules**
4. ุงุณุชุจุฏู ุงูููุงุนุฏ ุจุงูููุฏ ุงูุฌุฏูุฏ ูู `FIRESTORE_RULES_FIXED.rules`
5. ุงุถุบุท **Publish**

### 2. ุงูุชุญูู ูู ุจูุงูุงุช ุงููุณุชุฎุฏู:

ุชุฃูุฏ ูู ุฃู ุงููุณุชุฎุฏู Admin ูุฏูู ูุซููุฉ ูู Firestore:

```
Collection: users
Document ID: {user_uid}
Fields:
  - email: "admin@example.com"
  - role: "admin"  โ ูุฐุง ููู!
  - name: "Admin Name" (optional)
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ:

### 1. ุฏูุฑ ุงููุณุชุฎุฏู:
- ูุฌุจ ุฃู ูููู `role: 'admin'` (lowercase) ูู Firestore
- ููุณ `role: 'Admin'` ุฃู `admin: true`

### 2. ุฃุฏุงุก Security Rules:
- ุงุณุชุฎุฏุงู `get()` ูุฒูุฏ ูู ุนุฏุฏ ุงููุฑุงุกุงุช
- ูุฐุง ููุจูู ููุฅูุชุงุฌุ ูููู ุงุญุณุจ ุงูุชูููุฉ

### 3. ุงูุฃูุงู:
- โ `role` ูุญูู ูู ุงูุชุนุฏูู ูู ูุจู ุงููุณุชุฎุฏููู ุงูุนุงุฏููู
- โ Admin ููุท ููููู ุชุบููุฑ `role`
- โ ุงููุณุชุฎุฏููู ุงูุนุงุฏููู ูููููู ูุฑุงุกุฉ/ูุชุงุจุฉ ุจูุงูุงุชูู ููุท

---

## โ ุงููุชูุฌุฉ:

ุจุนุฏ ุชุญุฏูุซ ุงูููุงุนุฏ:
- โ Admin Dashboard ุณูุนูู ุจุดูู ุตุญูุญ
- โ ุงููุณุชุฎุฏููู ุงูุนุงุฏููู ูููููู ูุฑุงุกุฉ/ูุชุงุจุฉ ุทูุจุงุชูู
- โ ุงูููุชุฌุงุช ูุงุจูุฉ ูููุฑุงุกุฉ ููุฌููุนุ ุงููุชุงุจุฉ ููู Admin ููุท

---

**ุชุงุฑูุฎ ุงูุฅุตูุงุญ:** 2025-01-11  
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุชุทุจูู
