# ุฅุตูุงุญ ูุดููุฉ Firestore Index ๐ง

## ุงููุดููุฉ:
ุนูุฏ ูุชุญ ุตูุญุฉ ุงูุทูุจุงุช ูู ุงูุชุทุจููุ ูุธูุฑ ุฎุทุฃ:
```
The query requires an index. You can create it here: https://console.firebase.google.com/...
```

## ุงูุณุจุจ:
ุงูููุฏ ูุงู ูุณุชุฎุฏู `where('userId')` ูุน `orderBy('createdAt')` ูู ููุณ ุงูุงุณุชุนูุงูุ ููุฐุง ูุชุทูุจ **Composite Index** ูู Firestore.

## ุงูุญู ุงููุทุจู:

### โ ุงูุญู 1: ุชุฑุชูุจ ูู Dart (ูุทุจู ุงูุขู)
ุชู ุชุนุฏูู `getUserOrders` ูู `firestore_order_repository.dart`:
- ุฅุฒุงูุฉ `orderBy('createdAt')` ูู ุงูุงุณุชุนูุงู
- ุชุฑุชูุจ ุงููุชุงุฆุฌ ูู Dart ุจุนุฏ ุงูุฌูุจ

**ุงููููุฒุงุช:**
- โ ูุง ูุญุชุงุฌ ุฅูู Index
- โ ูุนูู ููุฑุงู ุจุฏูู ุฅุนุฏุงุฏ
- โ ููุงุณุจ ูููุดุงุฑูุน ุงูุตุบูุฑุฉ

**ุงูุนููุจ:**
- โ๏ธ ุชุฑุชูุจ ุนูู ูุณุชูู ุงูุนููู (Client-side)
- โ๏ธ ูุฏ ูููู ุฃุจุทุฃ ููููุงู ูุน ุนุฏุฏ ูุจูุฑ ูู ุงูุทูุจุงุช

---

### ๐ง ุงูุญู 2: ุฅูุดุงุก Composite Index (ููุฃุฏุงุก ุงูุฃูุถู - ุงุฎุชูุงุฑู)

ุฅุฐุง ุฃุฑุฏุช ุงูุฃุฏุงุก ุงูุฃูุถู ูุน ุนุฏุฏ ูุจูุฑ ูู ุงูุทูุจุงุช:

#### ุงูุฎุทูุฉ 1: ุงูุชุญ ุงูุฑุงุจุท ูู ุงูุฎุทุฃ
ุงูุชุญ ุงูุฑุงุจุท ุงูููุฌูุฏ ูู ุฑุณุงูุฉ ุงูุฎุทุฃ ูู ุงููุชุตูุญ.

ุฃู ุงูุชูู ุฅูู:
1. [Firebase Console](https://console.firebase.google.com/)
2. ุงุฎุชุฑ ูุดุฑูุนู: `seafood-marketplace-c98ae`
3. ุงุฐูุจ ุฅูู **Firestore Database** โ **Indexes**
4. ุงุถุบุท **Create Index**

#### ุงูุฎุทูุฉ 2: ุฅุนุฏุงุฏ ุงูู Index

**Collection ID:** `orders`

**Fields to index:**
1. `userId` - Ascending
2. `createdAt` - Descending

**Query scope:** Collection

#### ุงูุฎุทูุฉ 3: ุจุนุฏ ุฅูุดุงุก ุงูู Index

ุจุนุฏ ุฅูุดุงุก ุงูู Index (ูุฏ ูุณุชุบุฑู ุจุถุน ุฏูุงุฆู)ุ ููููู:
- ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู `orderBy('createdAt')` ูู ุงูููุฏ (ุงุฎุชูุงุฑู)
- ุฃู ุงูุฅุจูุงุก ุนูู ุงูุญู ุงูุญุงูู (ูุนูู ุจุดูู ุฌูุฏ)

---

## ุงูููู ุงููุนุฏู:

**`lib/features/checkout/data/firestore_order_repository.dart`**

```dart
Stream<List<Order>> getUserOrders(String userId) {
  return _firestore
      .collection(_collection)
      .where('userId', isEqualTo: userId)
      .snapshots()
      .map((snapshot) {
    // ุชุฑุชูุจ ุงูุทูุจุงุช ุญุณุจ createdAt (ุงูุฃุญุฏุซ ุฃููุงู) ูู Dart
    final orders = snapshot.docs
        .map((doc) => Order.fromFirestore(doc))
        .toList();
    
    // ุชุฑุชูุจ ุญุณุจ createdAt (ุงูุฃุญุฏุซ ุฃููุงู)
    orders.sort((a, b) {
      final aDate = a.createdAt ?? DateTime(0);
      final bDate = b.createdAt ?? DateTime(0);
      return bDate.compareTo(aDate); // ุชุฑุชูุจ ุชูุงุฒูู
    });
    
    return orders;
  });
}
```

---

## ุงูุชุญูู ูู ุงูุญู:

1. โ ุฃุนุฏ ุชุดุบูู ุงูุชุทุจูู
2. โ ุงูุชุญ ุตูุญุฉ ุงูุทูุจุงุช
3. โ ูุฌุจ ุฃู ุชุนูู ุจุฏูู ุฃุฎุทุงุก
4. โ ุงูุทูุจุงุช ูุฑุชุจุฉ ูู ุงูุฃุญุฏุซ ุฅูู ุงูุฃูุฏู

---

## ููุงุญุธุงุช:

- ุงูุญู ุงูุญุงูู ูุนูู ุจุดูู ุฌูุฏ ููุนุฏุฏ ุงููุนุชุงุฏ ูู ุงูุทูุจุงุช
- ุฅุฐุง ุฃุตุจุญ ุนุฏุฏ ุงูุทูุจุงุช ูุจูุฑุงู ุฌุฏุงู (ูุฆุงุช/ุขูุงู)ุ ููููู ุฅูุดุงุก Index ููุฃุฏุงุก ุงูุฃูุถู
- ููุญุฉ Admin ุชุนูู ุจุดูู ุตุญูุญ ูุฃููุง ุชุณุชุฎุฏู ุงุณุชุนูุงูุงุช ูุฎุชููุฉ (ูุง ุชุญุชุงุฌ Index)

---

**ุชุงุฑูุฎ ุงูุฅุตูุงุญ:** 2025-01-11  
**ุงูุญุงูุฉ:** โ ุชู ุงูุฅุตูุงุญ - ูุนูู ุจุฏูู ุฃุฎุทุงุก
